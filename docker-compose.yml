services:
    db:
        image: postgres:17.6
        env_file:
            - .env
        container_name: mediann-dev-postgres-db
        healthcheck:
            test: ["CMD-SHELL", "sh -c 'pg_isready -U $${POSTGRES_USER} -d $${POSTGRES_DB}'"]
            interval: 10s
            timeout: 3s
            retries: 3
        ports:
          - "${POSTGRES_PORT}:5432"
    redpanda:
        image: redpandadata/redpanda:latest
        container_name: mediann-dev-redpanda
        command: >
          redpanda start --overprovisioned --smp 1 --memory 1G
          --reserve-memory 0M --node-id 0 --check=false
          --kafka-addr PLAINTEXT://0.0.0.0:9092
          --advertise-kafka-addr PLAINTEXT://localhost:9092
          --set redpanda.auto_create_topics_enabled=true
        healthcheck:
            test: ["CMD", "bash", "-c", "rpk cluster info -X brokers=localhost:9092 || exit 1"]
            interval: 10s
            timeout: 5s
            retries: 5
        ports:
          - "9092:9092"
          - "9644:9644"
